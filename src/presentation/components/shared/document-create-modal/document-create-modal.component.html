<div
  class="document-create-modal"
  [class.rtl]="isRTL"
  [attr.dir]="isRTL ? 'rtl' : 'ltr'"
  >
  <h2 mat-dialog-title [class.arabic-font]="isRTL">
    {{ "documents.create.modalTitle" | translate }}
  </h2>

  <mat-dialog-content>
    <form [formGroup]="documentForm" class="document-form">
      <!-- Document Title -->
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>{{ "documents.form.title" | translate }}</mat-label>
        <input
          matInput
          formControlName="title"
          [placeholder]="'documents.form.titlePlaceholder' | translate"
          />
          @if (documentForm.get('title')?.hasError('required')) {
            <mat-error>
              {{ "documents.create.validation.required" | translate }}
            </mat-error>
          }
          @if (documentForm.get('title')?.hasError('maxlength')) {
            <mat-error>
              {{ "documents.create.validation.maxLength" | translate }}
            </mat-error>
          }
        </mat-form-field>

        <!-- From Department -->
        <!-- Department and Priority in one row -->
        <div class="flex-row-container">
          <mat-form-field appearance="outline" class="form-field mr-2">
            <mat-label>{{ "documents.form.department" | translate }}</mat-label>
            <mat-select formControlName="fromDepartment">
              @for (department of departments; track department) {
                <mat-option
                  [value]="department.id"
                  >
                  {{ isRTL ? department.name_ar : department.name_en }}
                </mat-option>
              }
            </mat-select>
            @if (documentForm.get('fromDepartment')?.hasError('required')) {
              <mat-error
                >
                {{ "documents.create.validation.required" | translate }}
              </mat-error>
            }
          </mat-form-field>

          <!-- Priority -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>{{ "documents.form.priority" | translate }}</mat-label>
            <mat-select formControlName="priority">
              @for (priority of priorities; track priority) {
                <mat-option [value]="priority.toLowerCase()">
                  {{ priority.toLowerCase() | translate }}
                </mat-option>
              }
            </mat-select>
            @if (documentForm.get('priority')?.hasError('required')) {
              <mat-error>
                {{ "documents.create.validation.required" | translate }}
              </mat-error>
            }
          </mat-form-field>
        </div>

        <!-- Document Description -->
        <div class="flex-row-container">
          <textarea
            class="form-field"
            matInput
            formControlName="description"
            rows="5"
            [placeholder]="'documents.form.descriptionPlaceholder' | translate"
          ></textarea>
        </div>

        <!-- File Type Switch -->
        <div class="file-type-container">
          <div class="file-type-label">
            <span [class.arabic-font]="isRTL">{{
              "documents.form.fileType" | translate
            }}</span>
          </div>
          <div class="file-type-switch">
            <span [class.arabic-font]="isRTL"
                  [class.active]="fileType === 'pdf'">
              {{ "documents.form.pdfMode" | translate }}
            </span>
            <mat-slide-toggle
              [checked]="fileType === 'images'"
              (change)="onFileTypeChange(!$event.checked)"
              color="primary">
            </mat-slide-toggle>
            <span [class.arabic-font]="isRTL"
                  [class.active]="fileType === 'images'">
              {{ "documents.form.imageMode" | translate }}
            </span>
          </div>
        </div>

        <!-- File Upload -->
        <div class="file-upload-container">
          <div class="file-upload-label">
            <span [class.arabic-font]="isRTL">{{
              fileType === 'pdf' ?
              ("documents.form.pdfAttachment" | translate) :
              ("documents.form.imageAttachments" | translate)
            }}</span>
            <span class="required-indicator">*</span>
          </div>

          <div
            class="file-upload-area"
            [class.has-files]="selectedFiles.length > 0"
            [class.invalid]="
              documentForm.get('files')?.invalid &&
              documentForm.get('files')?.touched
            "
            >
            <input
              type="file"
              #fileInput
              [accept]="fileType === 'pdf' ? '.pdf' : 'image/*'"
              [multiple]="fileType === 'images'"
              class="file-input"
              (change)="onFilesSelected($event)"
              />

              <div class="upload-content">
                <mat-icon>upload_file</mat-icon>
                @if (selectedFiles.length === 0) {
                  <span [class.arabic-font]="isRTL">
                    {{ fileType === 'pdf' ?
                       ("documents.create.dragDropPdf" | translate) :
                       ("documents.create.dragDropImages" | translate)
                    }}
                  </span>
                }
                @if (selectedFiles.length > 0) {
                  <div class="selected-files">
                    @for (file of selectedFiles; track file.name; let i = $index) {
                      <div class="file-item">
                        <span class="file-name" [class.arabic-font]="isRTL">
                          {{ getFileNameFromPath(file.name) }}
                        </span>
                        <button
                          type="button"
                          mat-icon-button
                          color="warn"
                          (click)="removeFile(i)"
                          class="remove-file-btn">
                          <mat-icon>close</mat-icon>
                        </button>
                      </div>
                    }
                  </div>
                }
                <button
                  type="button"
                  mat-stroked-button
                  color="primary"
                  (click)="fileInput.click()"
                  class="browse-btn"
                  >
                  {{ selectedFiles.length === 0 ?
                     (fileType === 'pdf' ?
                      ("documents.create.uploadPdf" | translate) :
                      ("documents.create.uploadImages" | translate)) :
                     (fileType === 'pdf' ?
                      ("documents.create.changeFile" | translate) :
                      ("documents.create.addMoreFiles" | translate))
                  }}
                </button>
              </div>
            </div>

            @if (
              documentForm.get('files')?.invalid &&
              documentForm.get('files')?.touched
              ) {
              <div
                class="error-message"
                >
                {{ "documents.create.validation.required" | translate }}
              </div>
            }
          </div>
        </form>
      </mat-dialog-content>

      <mat-dialog-actions align="end">
        <button mat-button (click)="onCancel()" [class.arabic-font]="isRTL">
          {{ "common.cancel" | translate }}
        </button>
        <button
          mat-raised-button
          color="primary"
          (click)="onSubmit()"
          [disabled]="documentForm.invalid"
          [class.arabic-font]="isRTL"
          >
          {{ "common.save" | translate }}
        </button>
      </mat-dialog-actions>
    </div>
