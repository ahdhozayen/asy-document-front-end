<h2 mat-dialog-title class="rtl">{{ "documents.signAndComment.title" | translate }}</h2>
<form [formGroup]="form">
  <div mat-dialog-content class="rtl" dir="rtl">
    @if (isReplacement) {
      <div class="replacement-warning" style="background-color: #fff3cd; padding: 12px; margin-bottom: 16px; border-radius: 4px; border-left: 4px solid #fbbf24;">
        <strong style="color: #856404;">⚠️ {{ "documents.signAndComment.replacementWarning" | translate }}</strong>
        <p style="margin: 8px 0 0 0; color: #856404; font-size: 0.9em;">
          {{ "documents.signAndComment.replacementInfo" | translate }}
        </p>
      </div>
    }
    <div class="signature-section">
      <label>{{ "documents.signAndComment.commentsLabel" | translate }} ({{ "common.optional" | translate }})</label>
      <mat-form-field appearance="outline" class="form-field">
        <textarea style="background-color: #fff;" matInput formControlName="comments" rows="4" cols="60"></textarea>
      </mat-form-field>
    </div>

    <div class="signature-section">
      <label>{{ "documents.signAndComment.signatureLabel" | translate }} ({{ "common.optional" | translate }})</label>
      <div class="signature-pad-container rtl">
        <canvas
          #signatureCanvas
          (mousedown)="onMouseDown($event)"
          (mousemove)="onMouseMove($event)"
          (mouseup)="onMouseUp()"
          (mouseleave)="onMouseUp()"
          (touchstart)="onTouchStart($event)"
          (touchmove)="onTouchMove($event)"
          (touchend)="onTouchEnd()"
          class="signature-canvas"
          >
        </canvas>
        <button
          mat-stroked-button
          type="button"
          (click)="clearCanvas()"
          class="clear-btn"
          >
          <mat-icon>clear</mat-icon>
          {{ "documents.signAndComment.clearSignature" | translate }}
        </button>
      </div>
    </div>
  </div>

  <div mat-dialog-actions align="end">
    <button mat-button type="button" (click)="onCancel()" [disabled]="isLoading">
      {{ "common.cancel" | translate }}
    </button>
    <button
      mat-raised-button
      color="primary"
      type="submit"
      (click)="onSave()"
      [disabled]="isLoading"
      >
      @if (isLoading) {
        <mat-spinner diameter="20" class="button-spinner" />
      }
      {{ isLoading ? ("common.saving" | translate) : ("common.save" | translate) }}
    </button>
  </div>
</form>
