<h2 mat-dialog-title>{{ "documents.signAndComment.title" | translate }}</h2>
<form [formGroup]="form">
  <div mat-dialog-content [class.rtl]="isRTL" [attr.dir]="isRTL ? 'rtl' : 'ltr'">
    <div class="signature-section">
      <label>{{ "documents.signAndComment.commentsLabel" | translate }}</label>
      <mat-form-field   appearance="outline" class="form-field">
        <textarea style="background-color: #fff;" matInput formControlName="comments" rows="4" cols="60" ></textarea>
        @if (form.get('comments')?.hasError('required') && form.get('comments')?.touched) {
          <mat-error>
            {{ "documents.signAndComment.commentsRequired" | translate }}
          </mat-error>
        }
        @if (form.get('comments')?.hasError('minlength') && form.get('comments')?.touched) {
          <mat-error>
            {{ "documents.signAndComment.commentsMinLength" | translate:{min:2} }}
          </mat-error>
        }
      </mat-form-field>
    </div>

    <div class="signature-section">
      <label>{{ "documents.signAndComment.signatureLabel" | translate }}</label>
      <div class="signature-pad-container">
        <canvas
          #signatureCanvas
          (mousedown)="onMouseDown($event)"
          (mousemove)="onMouseMove($event)"
          (mouseup)="onMouseUp()"
          (mouseleave)="onMouseUp()"
          (touchstart)="onTouchStart($event)"
          (touchmove)="onTouchMove($event)"
          (touchend)="onTouchEnd()"
          width="400"
          height="300"
          class="signature-canvas"
          >
        </canvas>
        <button
          mat-stroked-button
          type="button"
          (click)="clearCanvas()"
          class="clear-btn"
          >
          <mat-icon>clear</mat-icon>
          {{ "documents.signAndComment.clearSignature" | translate }}
        </button>
      </div>
      @if (form.get('signature')?.invalid && form.get('signature')?.touched) {
        <div
          class="error-message"
          >
          {{ "documents.signAndComment.signatureRequired" | translate }}
        </div>
      }
    </div>
  </div>

  <div mat-dialog-actions align="end">
    <button mat-button type="button" (click)="onCancel()" [disabled]="isLoading">
      {{ "common.cancel" | translate }}
    </button>
    <button
      mat-raised-button
      color="primary"
      type="submit"
      (click)="onSave()"
      [disabled]="form.invalid || isLoading"
      >
      @if (isLoading) {
        <mat-spinner diameter="20" class="button-spinner" />
      }
      {{ isLoading ? ("common.saving" | translate) : ("common.save" | translate) }}
    </button>
  </div>
</form>
